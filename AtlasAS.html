<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atlas Storage System</title>
  <style>
    body {
      background-color: #0d0f14;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.6), 0 0 20px rgba(59, 130, 246, 0.3);
      margin-bottom: 2rem;
    }

    .sidebar {
      width: 250px;
      background-color: #1a1d24;
      padding: 2rem 1rem;
      box-shadow: 5px 0 15px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .sidebar .top {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .sidebar .bottom {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .sidebar button {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      background-color: #2b2f3a;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }

    .sidebar button:hover {
      background-color: #3b82f6;
    }

    .main-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .tab {
      padding: 0.5rem 1.5rem;
      background-color: #1f2937;
      border-radius: 999px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .tab.active {
      background-color: #3b82f6;
    }

    .container {
      background-color: #1a1d24;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
    }

    .file-list, .logs {
      margin-top: 2rem;
    }

    .file-item, .log-item {
      background-color: #11131a;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .file-name {
      font-weight: bold;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="top">
      <h1>Atlas Storage</h1>
      <div class="tabs">
        <div class="tab active" onclick="showTab('files')">Files</div>
        <div class="tab" onclick="showTab('logs')">Logs</div>
      </div>
    </div>
    <div class="bottom">
      <button onclick="triggerFileUpload()">Upload File</button>
      <input type="file" id="fileInput" style="display: none" onchange="saveFile()" />
    </div>
  </div>

  <div class="main-content">
    <div class="container">
      <div id="files" class="tab-content active">
        <div class="file-list" id="fileList"></div>
      </div>
      <div id="logs" class="tab-content">
        <div class="logs" id="logList"></div>
      </div>
    </div>
  </div>

  <script>
    const dbName = "AtlasStorageDB";
    let db;

    const openDB = indexedDB.open(dbName, 1);

    openDB.onupgradeneeded = function (e) {
      db = e.target.result;
      db.createObjectStore("files", { keyPath: "id", autoIncrement: true });
    };

    openDB.onsuccess = function (e) {
      db = e.target.result;
      listFiles();
    };

    function triggerFileUpload() {
      document.getElementById("fileInput").click();
    }

    function saveFile() {
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function () {
        const loggedInUser = localStorage.getItem('loggedInUser');
        if (!loggedInUser) {
            alert("You must log in first!");
            return;
        }

        const fileData = {
          name: file.name,
          data: reader.result,
          timestamp: new Date().toLocaleString(),
          user: loggedInUser
        };

        const tx = db.transaction(["files"], "readwrite");
        const store = tx.objectStore("files");
        store.add(fileData);
        tx.oncomplete = () => {
            logAction(`Uploaded file: ${file.name}`);
            fileInput.value = null;
            listFiles();
        };
      };
      reader.readAsDataURL(file);
    }

    function listFiles() {
      const fileList = document.getElementById("fileList");
      fileList.innerHTML = "";

      const tx = db.transaction(["files"], "readonly");
      const store = tx.objectStore("files");
      const request = store.openCursor();
      let count = 0;
      let folderIndex = 1;
      let folderDiv = null;

      request.onsuccess = function (e) {
        const cursor = e.target.result;
        if (cursor) {
          if (cursor.value.user !== localStorage.getItem('loggedInUser')) {
            cursor.continue();
            return;
          }

          if (count % 10 === 0) {
            folderDiv = document.createElement("div");
            folderDiv.className = "file-item";
            folderDiv.innerHTML = `<div class="file-name">Folder ${folderIndex++}</div>`;
            fileList.appendChild(folderDiv);
          }

          const file = cursor.value;

          const div = document.createElement("div");
          div.className = "file-item";
          div.innerHTML = `
            <div class="file-name">${file.name}</div>
            <div>Uploaded: ${file.timestamp}</div>
            <button onclick="downloadFile(${cursor.key})">Download</button>
            <button onclick="deleteFile(${cursor.key})">Delete</button>
          `;

          folderDiv.appendChild(div);
          count++;
          cursor.continue();
        }
      };
    }

    function downloadFile(id) {
      const tx = db.transaction(["files"], "readonly");
      const store = tx.objectStore("files");
      const request = store.get(id);

      request.onsuccess = function () {
        const file = request.result;
        const a = document.createElement("a");
        a.href = file.data;
        a.download = file.name;
        a.click();
        logAction(`Downloaded file: ${file.name}`);
      };
    }

    function deleteFile(id) {
      const tx = db.transaction(["files"], "readwrite");
      const store = tx.objectStore("files");
      const getReq = store.get(id);

      getReq.onsuccess = () => {
        const file = getReq.result;
        store.delete(id);
        tx.oncomplete = () => {
          logAction(`Deleted file: ${file.name}`);
          listFiles();
        };
      };
    }

    function logAction(action) {
      const logList = document.getElementById("logList");
      const entry = document.createElement("div");
      entry.className = "log-item";
      entry.textContent = `[${new Date().toLocaleString()}] ${action}`;
      logList.prepend(entry);
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`.tab[onclick*="${tabId}"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }
  </script>
</body>
</html>
